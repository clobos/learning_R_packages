<!DOCTYPE html>
<html lang="Pt-Br" xml:lang="Pt-Br">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>7 Extra | Learning R packages</title>
  <meta name="description" content="<p>This is a minimal example of using the bookdown package to write a book.
set in the _output.yml file.
The HTML output format for this example is bookdown::gitbook,</p>" />
  <meta name="generator" content="bookdown 0.30 and GitBook 2.6.7" />

  <meta property="og:title" content="7 Extra | Learning R packages" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="<p>This is a minimal example of using the bookdown package to write a book.
set in the _output.yml file.
The HTML output format for this example is bookdown::gitbook,</p>" />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="7 Extra | Learning R packages" />
  
  <meta name="twitter:description" content="<p>This is a minimal example of using the bookdown package to write a book.
set in the _output.yml file.
The HTML output format for this example is bookdown::gitbook,</p>" />
  

<meta name="author" content="Cristian Villegas" />


<meta name="date" content="2023-06-16" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="broom-and-dplyr.html"/>
<link rel="next" href="data-science-r-packages.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Learning R packages</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Intro</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#carrega-pacotes-a-serem-usados"><i class="fa fa-check"></i><b>1.1</b> Carrega pacotes a serem usados</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#alguns-atalhos-no-rstudio"><i class="fa fa-check"></i><b>1.2</b> Alguns atalhos no Rstudio</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="dplyr-60-minutos.html"><a href="dplyr-60-minutos.html"><i class="fa fa-check"></i><b>2</b> dplyr (60 minutos)</a>
<ul>
<li class="chapter" data-level="2.1" data-path="dplyr-60-minutos.html"><a href="dplyr-60-minutos.html#carrega-pacotes-a-serem-usados-1"><i class="fa fa-check"></i><b>2.1</b> Carrega pacotes a serem usados</a></li>
<li class="chapter" data-level="2.2" data-path="dplyr-60-minutos.html"><a href="dplyr-60-minutos.html#descrição-dos-dados-mpg"><i class="fa fa-check"></i><b>2.2</b> Descrição dos dados <code>mpg</code></a></li>
<li class="chapter" data-level="2.3" data-path="dplyr-60-minutos.html"><a href="dplyr-60-minutos.html#lista-de-funções-do-pacote-dplyr"><i class="fa fa-check"></i><b>2.3</b> Lista de funções do pacote dplyr</a></li>
<li class="chapter" data-level="2.4" data-path="dplyr-60-minutos.html"><a href="dplyr-60-minutos.html#operador-pipe"><i class="fa fa-check"></i><b>2.4</b> Operador Pipe</a></li>
<li class="chapter" data-level="2.5" data-path="dplyr-60-minutos.html"><a href="dplyr-60-minutos.html#select-para-colunas"><i class="fa fa-check"></i><b>2.5</b> select() para colunas</a></li>
<li class="chapter" data-level="2.6" data-path="dplyr-60-minutos.html"><a href="dplyr-60-minutos.html#rename"><i class="fa fa-check"></i><b>2.6</b> rename()</a></li>
<li class="chapter" data-level="2.7" data-path="dplyr-60-minutos.html"><a href="dplyr-60-minutos.html#mutate-para-colunas"><i class="fa fa-check"></i><b>2.7</b> mutate() para colunas</a></li>
<li class="chapter" data-level="2.8" data-path="dplyr-60-minutos.html"><a href="dplyr-60-minutos.html#transmute"><i class="fa fa-check"></i><b>2.8</b> transmute()</a></li>
<li class="chapter" data-level="2.9" data-path="dplyr-60-minutos.html"><a href="dplyr-60-minutos.html#filter-para-linhas"><i class="fa fa-check"></i><b>2.9</b> filter() para linhas</a></li>
<li class="chapter" data-level="2.10" data-path="dplyr-60-minutos.html"><a href="dplyr-60-minutos.html#slice-para-linhas"><i class="fa fa-check"></i><b>2.10</b> slice() para linhas</a></li>
<li class="chapter" data-level="2.11" data-path="dplyr-60-minutos.html"><a href="dplyr-60-minutos.html#arrange-para-linhas"><i class="fa fa-check"></i><b>2.11</b> arrange() para linhas</a></li>
<li class="chapter" data-level="2.12" data-path="dplyr-60-minutos.html"><a href="dplyr-60-minutos.html#distinct-para-linhas"><i class="fa fa-check"></i><b>2.12</b> distinct() para linhas</a></li>
<li class="chapter" data-level="2.13" data-path="dplyr-60-minutos.html"><a href="dplyr-60-minutos.html#summarise"><i class="fa fa-check"></i><b>2.13</b> summarise()</a></li>
<li class="chapter" data-level="2.14" data-path="dplyr-60-minutos.html"><a href="dplyr-60-minutos.html#group_by"><i class="fa fa-check"></i><b>2.14</b> group_by()</a></li>
<li class="chapter" data-level="2.15" data-path="dplyr-60-minutos.html"><a href="dplyr-60-minutos.html#count"><i class="fa fa-check"></i><b>2.15</b> count()</a></li>
<li class="chapter" data-level="2.16" data-path="dplyr-60-minutos.html"><a href="dplyr-60-minutos.html#sample_n"><i class="fa fa-check"></i><b>2.16</b> sample_n()</a></li>
<li class="chapter" data-level="2.17" data-path="dplyr-60-minutos.html"><a href="dplyr-60-minutos.html#sample_frac"><i class="fa fa-check"></i><b>2.17</b> sample_frac()</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="ggplot2-60-minutos.html"><a href="ggplot2-60-minutos.html"><i class="fa fa-check"></i><b>3</b> ggplot2 (60 minutos)</a>
<ul>
<li class="chapter" data-level="3.1" data-path="ggplot2-60-minutos.html"><a href="ggplot2-60-minutos.html#carrega-pacotes-a-serem-usados-2"><i class="fa fa-check"></i><b>3.1</b> Carrega pacotes a serem usados</a></li>
<li class="chapter" data-level="3.2" data-path="ggplot2-60-minutos.html"><a href="ggplot2-60-minutos.html#lista-de-funções-do-pacote-ggplot2"><i class="fa fa-check"></i><b>3.2</b> Lista de funções do pacote ggplot2</a></li>
<li class="chapter" data-level="3.3" data-path="ggplot2-60-minutos.html"><a href="ggplot2-60-minutos.html#primeiros-passos-usando-geom_point"><i class="fa fa-check"></i><b>3.3</b> Primeiros passos usando geom_point</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="ggplot2-60-minutos.html"><a href="ggplot2-60-minutos.html#mais-detalhes-sobre-geom_point"><i class="fa fa-check"></i><b>3.3.1</b> Mais detalhes sobre geom_point</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="ggplot2-60-minutos.html"><a href="ggplot2-60-minutos.html#smooth-boxplot-histogram"><i class="fa fa-check"></i><b>3.4</b> smooth, boxplot, histogram</a></li>
<li class="chapter" data-level="3.5" data-path="ggplot2-60-minutos.html"><a href="ggplot2-60-minutos.html#gridextra-e-patchwork"><i class="fa fa-check"></i><b>3.5</b> gridExtra e patchwork</a></li>
<li class="chapter" data-level="3.6" data-path="ggplot2-60-minutos.html"><a href="ggplot2-60-minutos.html#bar-col-density-density2d"><i class="fa fa-check"></i><b>3.6</b> bar, col, density, density2d</a></li>
<li class="chapter" data-level="3.7" data-path="ggplot2-60-minutos.html"><a href="ggplot2-60-minutos.html#facet_grid-facet_wrap"><i class="fa fa-check"></i><b>3.7</b> facet_grid, facet_wrap</a></li>
<li class="chapter" data-level="3.8" data-path="ggplot2-60-minutos.html"><a href="ggplot2-60-minutos.html#stat_function"><i class="fa fa-check"></i><b>3.8</b> stat_function</a></li>
<li class="chapter" data-level="3.9" data-path="ggplot2-60-minutos.html"><a href="ggplot2-60-minutos.html#stat_summary"><i class="fa fa-check"></i><b>3.9</b> stat_summary</a></li>
<li class="chapter" data-level="3.10" data-path="ggplot2-60-minutos.html"><a href="ggplot2-60-minutos.html#theme_"><i class="fa fa-check"></i><b>3.10</b> theme_*()</a></li>
<li class="chapter" data-level="3.11" data-path="ggplot2-60-minutos.html"><a href="ggplot2-60-minutos.html#gráfico-de-perfis-spaguetti-plot"><i class="fa fa-check"></i><b>3.11</b> Gráfico de perfis (Spaguetti plot)</a></li>
<li class="chapter" data-level="3.12" data-path="ggplot2-60-minutos.html"><a href="ggplot2-60-minutos.html#plotly"><i class="fa fa-check"></i><b>3.12</b> plotly</a></li>
<li class="chapter" data-level="3.13" data-path="ggplot2-60-minutos.html"><a href="ggplot2-60-minutos.html#esquisse"><i class="fa fa-check"></i><b>3.13</b> esquisse</a></li>
<li class="chapter" data-level="3.14" data-path="ggplot2-60-minutos.html"><a href="ggplot2-60-minutos.html#exemplo-esquisse"><i class="fa fa-check"></i><b>3.14</b> Exemplo esquisse</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="purrr.html"><a href="purrr.html"><i class="fa fa-check"></i><b>4</b> purrr</a>
<ul>
<li class="chapter" data-level="4.1" data-path="purrr.html"><a href="purrr.html#apply-a-function-to-each-element-of-a-list-or-atomic-vector"><i class="fa fa-check"></i><b>4.1</b> Apply a function to each element of a list or atomic vector</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="purrr.html"><a href="purrr.html#usage"><i class="fa fa-check"></i><b>4.1.1</b> Usage</a></li>
<li class="chapter" data-level="4.1.2" data-path="purrr.html"><a href="purrr.html#arguments"><i class="fa fa-check"></i><b>4.1.2</b> Arguments</a></li>
<li class="chapter" data-level="4.1.3" data-path="purrr.html"><a href="purrr.html#value"><i class="fa fa-check"></i><b>4.1.3</b> Value</a></li>
<li class="chapter" data-level="4.1.4" data-path="purrr.html"><a href="purrr.html#see-also"><i class="fa fa-check"></i><b>4.1.4</b> See Also</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="purrr.html"><a href="purrr.html#examples"><i class="fa fa-check"></i><b>4.2</b> Examples</a></li>
<li class="chapter" data-level="4.3" data-path="purrr.html"><a href="purrr.html#map-functions"><i class="fa fa-check"></i><b>4.3</b> map functions</a></li>
<li class="chapter" data-level="4.4" data-path="purrr.html"><a href="purrr.html#map2-functions"><i class="fa fa-check"></i><b>4.4</b> map2 functions</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="tidyr.html"><a href="tidyr.html"><i class="fa fa-check"></i><b>5</b> tidyr</a>
<ul>
<li class="chapter" data-level="5.1" data-path="tidyr.html"><a href="tidyr.html#nest"><i class="fa fa-check"></i><b>5.1</b> nest()</a></li>
<li class="chapter" data-level="5.2" data-path="tidyr.html"><a href="tidyr.html#unnest"><i class="fa fa-check"></i><b>5.2</b> unnest()</a></li>
<li class="chapter" data-level="5.3" data-path="tidyr.html"><a href="tidyr.html#exemplos-da-ajuda-do-r"><i class="fa fa-check"></i><b>5.3</b> Exemplos da ajuda do R</a></li>
<li class="chapter" data-level="5.4" data-path="tidyr.html"><a href="tidyr.html#mais-detalhes"><i class="fa fa-check"></i><b>5.4</b> Mais detalhes</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="broom-and-dplyr.html"><a href="broom-and-dplyr.html"><i class="fa fa-check"></i><b>6</b> broom and dplyr</a>
<ul>
<li class="chapter" data-level="6.1" data-path="broom-and-dplyr.html"><a href="broom-and-dplyr.html#tidy-bootstrapping"><i class="fa fa-check"></i><b>6.1</b> Tidy bootstrapping</a></li>
<li class="chapter" data-level="6.2" data-path="broom-and-dplyr.html"><a href="broom-and-dplyr.html#mais-detalhes-glance"><i class="fa fa-check"></i><b>6.2</b> Mais detalhes (glance)</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="broom-and-dplyr.html"><a href="broom-and-dplyr.html#lm"><i class="fa fa-check"></i><b>6.2.1</b> lm()</a></li>
<li class="chapter" data-level="6.2.2" data-path="broom-and-dplyr.html"><a href="broom-and-dplyr.html#nls"><i class="fa fa-check"></i><b>6.2.2</b> nls()</a></li>
<li class="chapter" data-level="6.2.3" data-path="broom-and-dplyr.html"><a href="broom-and-dplyr.html#glm"><i class="fa fa-check"></i><b>6.2.3</b> glm()</a></li>
<li class="chapter" data-level="6.2.4" data-path="broom-and-dplyr.html"><a href="broom-and-dplyr.html#gam"><i class="fa fa-check"></i><b>6.2.4</b> gam()</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="broom-and-dplyr.html"><a href="broom-and-dplyr.html#links"><i class="fa fa-check"></i><b>6.3</b> links</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="extra.html"><a href="extra.html"><i class="fa fa-check"></i><b>7</b> Extra</a>
<ul>
<li class="chapter" data-level="7.1" data-path="extra.html"><a href="extra.html#introduction"><i class="fa fa-check"></i><b>7.1</b> Introduction</a></li>
<li class="chapter" data-level="7.2" data-path="extra.html"><a href="extra.html#correlation"><i class="fa fa-check"></i><b>7.2</b> Correlation</a></li>
<li class="chapter" data-level="7.3" data-path="extra.html"><a href="extra.html#correlation-matrix"><i class="fa fa-check"></i><b>7.3</b> Correlation matrix</a></li>
<li class="chapter" data-level="7.4" data-path="extra.html"><a href="extra.html#testing-a-bivariate-association"><i class="fa fa-check"></i><b>7.4</b> Testing a bivariate association</a></li>
<li class="chapter" data-level="7.5" data-path="extra.html"><a href="extra.html#visualizing-the-association"><i class="fa fa-check"></i><b>7.5</b> Visualizing the association</a></li>
<li class="chapter" data-level="7.6" data-path="extra.html"><a href="extra.html#testing-the-significance-of-all-correlations-in-the-matrix"><i class="fa fa-check"></i><b>7.6</b> Testing the significance of all correlations in the matrix</a></li>
<li class="chapter" data-level="7.7" data-path="extra.html"><a href="extra.html#pretty-output"><i class="fa fa-check"></i><b>7.7</b> Pretty output</a></li>
<li class="chapter" data-level="7.8" data-path="extra.html"><a href="extra.html#keeping-the-correlations-for-further-analysis"><i class="fa fa-check"></i><b>7.8</b> Keeping the correlations for further analysis</a></li>
<li class="chapter" data-level="7.9" data-path="extra.html"><a href="extra.html#correlation-method"><i class="fa fa-check"></i><b>7.9</b> Correlation method</a></li>
<li class="chapter" data-level="7.10" data-path="extra.html"><a href="extra.html#missing-data"><i class="fa fa-check"></i><b>7.10</b> Missing data</a></li>
<li class="chapter" data-level="7.11" data-path="extra.html"><a href="extra.html#single-predictor-simple-regression"><i class="fa fa-check"></i><b>7.11</b> Single-predictor (simple) regression</a></li>
<li class="chapter" data-level="7.12" data-path="extra.html"><a href="extra.html#regression-diagnostics"><i class="fa fa-check"></i><b>7.12</b> Regression diagnostics</a></li>
<li class="chapter" data-level="7.13" data-path="extra.html"><a href="extra.html#bootstrap-estimates-and-confidence-intervals"><i class="fa fa-check"></i><b>7.13</b> Bootstrap estimates and confidence intervals</a></li>
<li class="chapter" data-level="7.14" data-path="extra.html"><a href="extra.html#multiple-regression"><i class="fa fa-check"></i><b>7.14</b> Multiple regression</a></li>
<li class="chapter" data-level="7.15" data-path="extra.html"><a href="extra.html#visualizing-regression-data"><i class="fa fa-check"></i><b>7.15</b> Visualizing regression data</a></li>
<li class="chapter" data-level="7.16" data-path="extra.html"><a href="extra.html#getting-results-into-a-tidy-useful-format"><i class="fa fa-check"></i><b>7.16</b> Getting results into a tidy, useful format</a></li>
<li class="chapter" data-level="7.17" data-path="extra.html"><a href="extra.html#modeling-interactions"><i class="fa fa-check"></i><b>7.17</b> Modeling interactions</a></li>
<li class="chapter" data-level="7.18" data-path="extra.html"><a href="extra.html#contrasts-in-regression"><i class="fa fa-check"></i><b>7.18</b> Contrasts in regression</a></li>
<li class="chapter" data-level="7.19" data-path="extra.html"><a href="extra.html#expected-means-for-protein-source"><i class="fa fa-check"></i><b>7.19</b> Expected means for protein source</a></li>
<li class="chapter" data-level="7.20" data-path="extra.html"><a href="extra.html#expected-means-for-protein-level"><i class="fa fa-check"></i><b>7.20</b> Expected means for protein level</a></li>
<li class="chapter" data-level="7.21" data-path="extra.html"><a href="extra.html#means-in-each-cell-of-the-factorial-design"><i class="fa fa-check"></i><b>7.21</b> Means in each cell of the factorial design</a></li>
<li class="chapter" data-level="7.22" data-path="extra.html"><a href="extra.html#pairwise-comparisons-among-protein-sources"><i class="fa fa-check"></i><b>7.22</b> Pairwise comparisons among protein sources</a></li>
<li class="chapter" data-level="7.23" data-path="extra.html"><a href="extra.html#pairwise-differences-and-simple-slopes-in-regression"><i class="fa fa-check"></i><b>7.23</b> Pairwise differences and simple slopes in regression</a></li>
<li class="chapter" data-level="7.24" data-path="extra.html"><a href="extra.html#a-few-other-emmeans-features"><i class="fa fa-check"></i><b>7.24</b> A few other emmeans features</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="data-science-r-packages.html"><a href="data-science-r-packages.html"><i class="fa fa-check"></i><b>8</b> Data Science r packages</a>
<ul>
<li class="chapter" data-level="8.1" data-path="data-science-r-packages.html"><a href="data-science-r-packages.html#knn"><i class="fa fa-check"></i><b>8.1</b> knn</a></li>
<li class="chapter" data-level="8.2" data-path="data-science-r-packages.html"><a href="data-science-r-packages.html#rpart"><i class="fa fa-check"></i><b>8.2</b> rpart</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i><b>9</b> References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Learning R packages</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="extra" class="section level1 hasAnchor" number="7">
<h1><span class="header-section-number">7</span> Extra<a href="extra.html#extra" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="introduction" class="section level2 hasAnchor" number="7.1">
<h2><span class="header-section-number">7.1</span> Introduction<a href="extra.html#introduction" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The overall goal is to give you a very quick introduction to conducting correlation and regression analyses in R.</p>
</div>
<div id="correlation" class="section level2 hasAnchor" number="7.2">
<h2><span class="header-section-number">7.2</span> Correlation<a href="extra.html#correlation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The Pearson product moment correlation seeks to measure the linear association between two variables, <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span> on a standardized scale ranging from <span class="math inline">\(r = -1 -- 1\)</span>.</p>
<p>The correlation of x and y is a covariance that has been standardized by the standard deviations of <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span>. This yields a scale-insensitive measure of the linear association of <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span>. For much more conceptual detail, see this: <a href="https://psu-psychology.github.io/psy-597-SEM/01_correlation_regression/01_Correlation_and_Regression.html" class="uri">https://psu-psychology.github.io/psy-597-SEM/01_correlation_regression/01_Correlation_and_Regression.html</a>.</p>
<p><span class="math display">\[r_{XY}= \frac{s_{XY}}{s_{X} s_{Y}}\]</span></p>
</div>
<div id="correlation-matrix" class="section level2 hasAnchor" number="7.3">
<h2><span class="header-section-number">7.3</span> Correlation matrix<a href="extra.html#correlation-matrix" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb422"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb422-1"><a href="extra.html#cb422-1" aria-hidden="true" tabindex="-1"></a>to_correlate <span class="ot">&lt;-</span> mtcars <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(qsec, cyl, disp, hp)</span>
<span id="cb422-2"><a href="extra.html#cb422-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(to_correlate)</span></code></pre></div>
<pre><code>##        qsec    cyl   disp     hp
## qsec  1.000 -0.591 -0.434 -0.708
## cyl  -0.591  1.000  0.902  0.832
## disp -0.434  0.902  1.000  0.791
## hp   -0.708  0.832  0.791  1.000</code></pre>
</div>
<div id="testing-a-bivariate-association" class="section level2 hasAnchor" number="7.4">
<h2><span class="header-section-number">7.4</span> Testing a bivariate association<a href="extra.html#testing-a-bivariate-association" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Recall that the significance of correlations are computed on <span class="math inline">\(n - 2\)</span> degrees of freedom.</p>
<p>The t-test is:</p>
<p><span class="math display">\[
t = \frac{r \sqrt{n - 2}}{\sqrt{1 - r^2}}
\]</span></p>
<div class="sourceCode" id="cb424"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb424-1"><a href="extra.html#cb424-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cor.test</span>(mtcars<span class="sc">$</span>qsec, mtcars<span class="sc">$</span>cyl)</span></code></pre></div>
<pre><code>## 
##  Pearson&#39;s product-moment correlation
## 
## data:  mtcars$qsec and mtcars$cyl
## t = -4, df = 30, p-value = 4e-04
## alternative hypothesis: true correlation is not equal to 0
## 95 percent confidence interval:
##  -0.779 -0.306
## sample estimates:
##    cor 
## -0.591</code></pre>
<p>Note that we can use the <code>conf.int</code> argument to <code>cor.test</code> to get different levels of confidence.</p>
<div class="sourceCode" id="cb426"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb426-1"><a href="extra.html#cb426-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cor.test</span>(mtcars<span class="sc">$</span>qsec, mtcars<span class="sc">$</span>cyl, <span class="at">conf.level =</span> <span class="fl">0.9</span>)</span></code></pre></div>
<pre><code>## 
##  Pearson&#39;s product-moment correlation
## 
## data:  mtcars$qsec and mtcars$cyl
## t = -4, df = 30, p-value = 4e-04
## alternative hypothesis: true correlation is not equal to 0
## 90 percent confidence interval:
##  -0.755 -0.358
## sample estimates:
##    cor 
## -0.591</code></pre>
</div>
<div id="visualizing-the-association" class="section level2 hasAnchor" number="7.5">
<h2><span class="header-section-number">7.5</span> Visualizing the association<a href="extra.html#visualizing-the-association" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb428"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb428-1"><a href="extra.html#cb428-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(to_correlate, <span class="fu">aes</span>(<span class="at">x=</span>cyl, <span class="at">y=</span>qsec)) <span class="sc">+</span> <span class="fu">geom_jitter</span>(<span class="at">width=</span><span class="fl">0.1</span>) <span class="sc">+</span> <span class="fu">stat_smooth</span>(<span class="at">method=</span><span class="st">&quot;lm&quot;</span>, <span class="at">se=</span><span class="cn">FALSE</span>)</span></code></pre></div>
<p><img src="06_extra_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
</div>
<div id="testing-the-significance-of-all-correlations-in-the-matrix" class="section level2 hasAnchor" number="7.6">
<h2><span class="header-section-number">7.6</span> Testing the significance of all correlations in the matrix<a href="extra.html#testing-the-significance-of-all-correlations-in-the-matrix" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb429"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb429-1"><a href="extra.html#cb429-1" aria-hidden="true" tabindex="-1"></a>Hmisc<span class="sc">::</span><span class="fu">rcorr</span>(to_correlate <span class="sc">%&gt;%</span> <span class="fu">as.matrix</span>())</span></code></pre></div>
<pre><code>##       qsec   cyl  disp    hp
## qsec  1.00 -0.59 -0.43 -0.71
## cyl  -0.59  1.00  0.90  0.83
## disp -0.43  0.90  1.00  0.79
## hp   -0.71  0.83  0.79  1.00
## 
## n= 32 
## 
## 
## P
##      qsec   cyl    disp   hp    
## qsec        0.0004 0.0131 0.0000
## cyl  0.0004        0.0000 0.0000
## disp 0.0131 0.0000        0.0000
## hp   0.0000 0.0000 0.0000</code></pre>
<p>Notice that we now get a matrix of p-values, too…</p>
</div>
<div id="pretty-output" class="section level2 hasAnchor" number="7.7">
<h2><span class="header-section-number">7.7</span> Pretty output<a href="extra.html#pretty-output" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb431"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb431-1"><a href="extra.html#cb431-1" aria-hidden="true" tabindex="-1"></a><span class="fu">stargazer</span>(<span class="fu">cor</span>(to_correlate), <span class="at">type =</span> <span class="st">&quot;html&quot;</span>)</span></code></pre></div>
<table style="text-align:center">
<tr>
<td colspan="5" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
qsec
</td>
<td>
cyl
</td>
<td>
disp
</td>
<td>
hp
</td>
</tr>
<tr>
<td colspan="5" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
qsec
</td>
<td>
1
</td>
<td>
-0.591
</td>
<td>
-0.434
</td>
<td>
-0.708
</td>
</tr>
<tr>
<td style="text-align:left">
cyl
</td>
<td>
-0.591
</td>
<td>
1
</td>
<td>
0.902
</td>
<td>
0.832
</td>
</tr>
<tr>
<td style="text-align:left">
disp
</td>
<td>
-0.434
</td>
<td>
0.902
</td>
<td>
1
</td>
<td>
0.791
</td>
</tr>
<tr>
<td style="text-align:left">
hp
</td>
<td>
-0.708
</td>
<td>
0.832
</td>
<td>
0.791
</td>
<td>
1
</td>
</tr>
<tr>
<td colspan="5" style="border-bottom: 1px solid black">
</td>
</tr>
</table>
<div class="sourceCode" id="cb432"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb432-1"><a href="extra.html#cb432-1" aria-hidden="true" tabindex="-1"></a><span class="co">#you can use the filename argument to write out the table as a Word doc!</span></span>
<span id="cb432-2"><a href="extra.html#cb432-2" aria-hidden="true" tabindex="-1"></a>apaTables<span class="sc">::</span><span class="fu">apa.cor.table</span>(to_correlate)</span></code></pre></div>
<pre><code>## 
## 
## Means, standard deviations, and correlations with confidence intervals
##  
## 
##   Variable M      SD     1            2          3         
##   1. qsec  17.85  1.79                                     
##                                                            
##   2. cyl   6.19   1.79   -.59**                            
##                          [-.78, -.31]                      
##                                                            
##   3. disp  230.72 123.94 -.43*        .90**                
##                          [-.68, -.10] [.81, .95]           
##                                                            
##   4. hp    146.69 68.56  -.71**       .83**      .79**     
##                          [-.85, -.48] [.68, .92] [.61, .89]
##                                                            
## 
## Note. M and SD are used to represent mean and standard deviation, respectively.
## Values in square brackets indicate the 95% confidence interval.
## The confidence interval is a plausible range of population correlations 
## that could have caused the sample correlation (Cumming, 2014).
##  * indicates p &lt; .05. ** indicates p &lt; .01.
## </code></pre>
</div>
<div id="keeping-the-correlations-for-further-analysis" class="section level2 hasAnchor" number="7.8">
<h2><span class="header-section-number">7.8</span> Keeping the correlations for further analysis<a href="extra.html#keeping-the-correlations-for-further-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Here, we store all details of the bivariate correlation test as an R object <code>ctest</code>.</p>
<div class="sourceCode" id="cb434"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb434-1"><a href="extra.html#cb434-1" aria-hidden="true" tabindex="-1"></a>ctest <span class="ot">&lt;-</span> <span class="fu">cor.test</span>(mtcars<span class="sc">$</span>qsec, mtcars<span class="sc">$</span>cyl)</span></code></pre></div>
<p>Let’s poke under the hood:</p>
<div class="sourceCode" id="cb435"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb435-1"><a href="extra.html#cb435-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(ctest)</span></code></pre></div>
<pre><code>## List of 9
##  $ statistic  : Named num -4.02
##   ..- attr(*, &quot;names&quot;)= chr &quot;t&quot;
##  $ parameter  : Named int 30
##   ..- attr(*, &quot;names&quot;)= chr &quot;df&quot;
##  $ p.value    : num 0.000366
##  $ estimate   : Named num -0.591
##   ..- attr(*, &quot;names&quot;)= chr &quot;cor&quot;
##  $ null.value : Named num 0
##   ..- attr(*, &quot;names&quot;)= chr &quot;correlation&quot;
##  $ alternative: chr &quot;two.sided&quot;
##  $ method     : chr &quot;Pearson&#39;s product-moment correlation&quot;
##  $ data.name  : chr &quot;mtcars$qsec and mtcars$cyl&quot;
##  $ conf.int   : num [1:2] -0.779 -0.306
##   ..- attr(*, &quot;conf.level&quot;)= num 0.95
##  - attr(*, &quot;class&quot;)= chr &quot;htest&quot;</code></pre>
<p>So, we can poke around and grab specific things:</p>
<div class="sourceCode" id="cb437"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb437-1"><a href="extra.html#cb437-1" aria-hidden="true" tabindex="-1"></a>ctest<span class="sc">$</span>p.value</span></code></pre></div>
<pre><code>## [1] 0.000366</code></pre>
<div class="sourceCode" id="cb439"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb439-1"><a href="extra.html#cb439-1" aria-hidden="true" tabindex="-1"></a>ctest<span class="sc">$</span>estimate</span></code></pre></div>
<pre><code>##    cor 
## -0.591</code></pre>
<p>And there are useful helper packages, especially <code>broom</code>, that will help you work with statistics objects as <code>data.frame</code> objects.</p>
<div class="sourceCode" id="cb441"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb441-1"><a href="extra.html#cb441-1" aria-hidden="true" tabindex="-1"></a>broom<span class="sc">::</span><span class="fu">glance</span>(ctest)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 8
##   estimate statistic  p.value parameter conf.low conf.high method        alter…¹
##      &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;int&gt;    &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;         &lt;chr&gt;  
## 1   -0.591     -4.02 0.000366        30   -0.779    -0.306 Pearson&#39;s pr… two.si…
## # … with abbreviated variable name ¹​alternative</code></pre>
</div>
<div id="correlation-method" class="section level2 hasAnchor" number="7.9">
<h2><span class="header-section-number">7.9</span> Correlation method<a href="extra.html#correlation-method" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>You can use a different correlation method (e.g., Spearman) using the <code>method</code> argument:</p>
<div class="sourceCode" id="cb443"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb443-1"><a href="extra.html#cb443-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cor.test</span>(mtcars<span class="sc">$</span>qsec, mtcars<span class="sc">$</span>cyl, <span class="at">method =</span> <span class="st">&quot;spearman&quot;</span>)</span></code></pre></div>
<pre><code>## 
##  Spearman&#39;s rank correlation rho
## 
## data:  mtcars$qsec and mtcars$cyl
## S = 8579, p-value = 6e-04
## alternative hypothesis: true rho is not equal to 0
## sample estimates:
##    rho 
## -0.572</code></pre>
<div class="sourceCode" id="cb445"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb445-1"><a href="extra.html#cb445-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(to_correlate, <span class="at">method =</span> <span class="st">&quot;spearman&quot;</span>)</span></code></pre></div>
<pre><code>##        qsec    cyl   disp     hp
## qsec  1.000 -0.572 -0.460 -0.667
## cyl  -0.572  1.000  0.928  0.902
## disp -0.460  0.928  1.000  0.851
## hp   -0.667  0.902  0.851  1.000</code></pre>
</div>
<div id="missing-data" class="section level2 hasAnchor" number="7.10">
<h2><span class="header-section-number">7.10</span> Missing data<a href="extra.html#missing-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>By default, <code>cor</code> will return an <code>NA</code> (missing) for every pair in which at least one observation is missing. We can ask for correlations to be estimated on the complete cases for each pair. This is <code>use="pairwise.complete.obs"</code>.</p>
<p>Here’s the difference (I introduced some missing data to make the point):</p>
<p>First, with ‘everything’ as the <code>use</code> argument (any missing on a variable drops it from the correlation table).</p>
<div class="sourceCode" id="cb447"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb447-1"><a href="extra.html#cb447-1" aria-hidden="true" tabindex="-1"></a>to_correlate_miss <span class="ot">&lt;-</span> to_correlate</span>
<span id="cb447-2"><a href="extra.html#cb447-2" aria-hidden="true" tabindex="-1"></a>to_correlate_miss<span class="sc">$</span>qsec[<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">5</span>)] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb447-3"><a href="extra.html#cb447-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(to_correlate_miss) <span class="co">#implicitly use=&quot;everything&quot;</span></span></code></pre></div>
<pre><code>##      qsec   cyl  disp    hp
## qsec    1    NA    NA    NA
## cyl    NA 1.000 0.902 0.832
## disp   NA 0.902 1.000 0.791
## hp     NA 0.832 0.791 1.000</code></pre>
<p>Now with pairwise complete calculation:</p>
<div class="sourceCode" id="cb449"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb449-1"><a href="extra.html#cb449-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(to_correlate_miss, <span class="at">use=</span><span class="st">&quot;pairwise.complete.obs&quot;</span>)</span></code></pre></div>
<pre><code>##        qsec    cyl   disp     hp
## qsec  1.000 -0.596 -0.448 -0.731
## cyl  -0.596  1.000  0.902  0.832
## disp -0.448  0.902  1.000  0.791
## hp   -0.731  0.832  0.791  1.000</code></pre>
</div>
<div id="single-predictor-simple-regression" class="section level2 hasAnchor" number="7.11">
<h2><span class="header-section-number">7.11</span> Single-predictor (simple) regression<a href="extra.html#single-predictor-simple-regression" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Next, let’s turn to ‘simple’ linear regression (one predictor, one outcome), then scale to multiple regression (many predictors, one outcome). The standard linear regression model is implemented by the <code>lm</code> function in R. The <code>lm</code> function uses ordinary least squares (OLS) which estimates the parameter by minimizing the squared residuals.</p>
<p>In simple regression, we are interested in a relationship of the form:</p>
<p><span class="math display">\[
Y = B_0 + B_1 X
\]</span></p>
<p>where <span class="math inline">\(Y\)</span> is the dependent variable (criterion) and <span class="math inline">\(X\)</span> is the predictor (covariate). The intercept is represented by <span class="math inline">\(B0\)</span> and the slope for the <span class="math inline">\(X\)</span> predictor by <span class="math inline">\(B1\)</span>.</p>
<p>Let’s take a look at the simple case of stopping distance (braking) as a function of car speed.</p>
<div class="sourceCode" id="cb451"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb451-1"><a href="extra.html#cb451-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cars, <span class="fu">aes</span>(<span class="at">x=</span>speed, <span class="at">y=</span>dist)) <span class="sc">+</span> </span>
<span id="cb451-2"><a href="extra.html#cb451-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color=</span><span class="st">&#39;darkblue&#39;</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span> </span>
<span id="cb451-3"><a href="extra.html#cb451-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span>lm, <span class="at">se=</span><span class="cn">FALSE</span>, <span class="at">fullrange=</span><span class="cn">TRUE</span>, <span class="at">color=</span><span class="st">&#39;black&#39;</span>, <span class="at">size=</span><span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb451-4"><a href="extra.html#cb451-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">&quot;Speed (mph)&quot;</span>, <span class="at">y=</span><span class="st">&quot;Stopping distance (ft)&quot;</span>)</span></code></pre></div>
<p><img src="06_extra_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
<p>When conducting regression, we typically try to capture linear relationships among variables. We can introduce higher-order polynomial terms (e.g., quadratic models) or splines (more flexible shapes), but this beyond the scope here.</p>
<p>Fortunately, this relationship looks quite linear! The faster the car, the longer it takes to brake.</p>
<p>In R regression models, we use the <code>~</code> operator to denote ‘regressed on’. It’s not especially intuitive, but we say the criterion is regressed on the predictor. Here, if we think speed is a key cause of stopping distance, we’d say ‘braking distance regressed on speed’ or ‘speed predicts braking distance.’</p>
<p>In formula terms, this is <code>dist ~ speed</code>, which we pass as the first argument to <code>lm()</code>.</p>
<div class="sourceCode" id="cb452"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb452-1"><a href="extra.html#cb452-1" aria-hidden="true" tabindex="-1"></a>lm_cars <span class="ot">&lt;-</span> <span class="fu">lm</span>(dist <span class="sc">~</span> speed, <span class="at">data=</span>cars)</span>
<span id="cb452-2"><a href="extra.html#cb452-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lm_cars)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = dist ~ speed, data = cars)
## 
## Residuals:
##    Min     1Q Median     3Q    Max 
## -29.07  -9.53  -2.27   9.21  43.20 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  -17.579      6.758   -2.60    0.012 *  
## speed          3.932      0.416    9.46  1.5e-12 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 15.4 on 48 degrees of freedom
## Multiple R-squared:  0.651,  Adjusted R-squared:  0.644 
## F-statistic: 89.6 on 1 and 48 DF,  p-value: 1.49e-12</code></pre>
<p>The output contains individual parameter estimates of the model (here, just the intercept and slope), their standard errors, significance tests, and p-values (one degree of freedom). We also get global information such as the sum of squared errors and the coefficient of determination (<span class="math inline">\(R^2\)</span>).</p>
</div>
<div id="regression-diagnostics" class="section level2 hasAnchor" number="7.12">
<h2><span class="header-section-number">7.12</span> Regression diagnostics<a href="extra.html#regression-diagnostics" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We can also get useful diagnostic plots for free using the <code>plot()</code> function:</p>
<div class="sourceCode" id="cb454"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb454-1"><a href="extra.html#cb454-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb454-2"><a href="extra.html#cb454-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(lm_cars)</span></code></pre></div>
<p><img src="06_extra_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
<p>The <code>ggfortify</code> package also provides an <code>autoplot</code> function that gives similar diagnostics within a handy ggplot-based graph.</p>
<div class="sourceCode" id="cb455"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb455-1"><a href="extra.html#cb455-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(lm_cars)</span></code></pre></div>
<p><img src="06_extra_files/figure-html/unnamed-chunk-19-1.png" width="672" /></p>
</div>
<div id="bootstrap-estimates-and-confidence-intervals" class="section level2 hasAnchor" number="7.13">
<h2><span class="header-section-number">7.13</span> Bootstrap estimates and confidence intervals<a href="extra.html#bootstrap-estimates-and-confidence-intervals" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Using functionality from the <code>car</code> and <code>boot</code> packges, we can easily get estimates of the regression coefficients and standard errors using nonparametric bootstrapping, which relaxes the normal theory assumption on the standard errors and, therefore, the significance tests. Likewise, the model does not assume normally distributed error.</p>
<p>Nonparametric bootstrapping approximates the sampling distribution for a statistic of interest (e.g., a slope) by resampling the existing data with replacement many times and examining the resulting density.</p>
<div class="sourceCode" id="cb456"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb456-1"><a href="extra.html#cb456-1" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>(lm_cars.boot <span class="ot">&lt;-</span> <span class="fu">Boot</span>(lm_cars, <span class="at">R=</span><span class="dv">2000</span>))</span></code></pre></div>
<pre><code>##   usuário   sistema decorrido 
##      2.66      0.07      2.87</code></pre>
<div class="sourceCode" id="cb458"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb458-1"><a href="extra.html#cb458-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lm_cars.boot, <span class="at">high.moments=</span><span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## 
## Number of bootstrap replications R = 2000 
##             original bootBias bootSE bootMed bootSkew bootKurtosis
## (Intercept)   -17.58 -0.04777   5.91  -17.44   -0.176       0.1168
## speed           3.93 -0.00189   0.42    3.92    0.113       0.0393</code></pre>
<p>We can use the object to obtain 95% bootstrapped confidence intervals using the ‘bias corrected, accelerated’ method (aka bca).</p>
<div class="sourceCode" id="cb460"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb460-1"><a href="extra.html#cb460-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(lm_cars.boot, <span class="at">level=</span>.<span class="dv">95</span>, <span class="at">type=</span><span class="st">&quot;bca&quot;</span>)</span></code></pre></div>
<pre><code>## Bootstrap bca confidence intervals
## 
##              2.5 % 97.5 %
## (Intercept) -30.64  -7.18
## speed         3.21   4.92</code></pre>
<p>And we can easily compare the bootstrapped and standard OLS models:</p>
<div class="sourceCode" id="cb462"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb462-1"><a href="extra.html#cb462-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(lm_cars.boot, <span class="at">legend=</span><span class="st">&quot;separate&quot;</span>)</span></code></pre></div>
<p><img src="06_extra_files/figure-html/unnamed-chunk-22-1.png" width="672" /></p>
<p>Notice that the <code>speed</code> regression coefficient is slightly positively skewed. Additional details are provided in John Fox’s useful book “An R Companion to Applied Regression” (2nd edition): <a href="https://socialsciences.mcmaster.ca/jfox/Books/Companion/appendix/Appendix-Bootstrapping.pdf" class="uri">https://socialsciences.mcmaster.ca/jfox/Books/Companion/appendix/Appendix-Bootstrapping.pdf</a>.</p>
</div>
<div id="multiple-regression" class="section level2 hasAnchor" number="7.14">
<h2><span class="header-section-number">7.14</span> Multiple regression<a href="extra.html#multiple-regression" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We can easily extend to larger regression models by adding terms to the right side of the formula. For example, in the <code>mtcars</code> dataset (car performance statistics from 1974 Motor Trend), we could examine the extent to which the gas mileage (<code>mpg</code>) is a function of both gross horsepower (<code>hp</code>) and transmission (<code>am</code>, where 0 is ‘automatic’ and 1 is ‘manual’).</p>
<div class="sourceCode" id="cb463"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb463-1"><a href="extra.html#cb463-1" aria-hidden="true" tabindex="-1"></a>mpg_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(mpg <span class="sc">~</span> hp <span class="sc">+</span> am, mtcars)</span>
<span id="cb463-2"><a href="extra.html#cb463-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mpg_model)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = mpg ~ hp + am, data = mtcars)
## 
## Residuals:
##    Min     1Q Median     3Q    Max 
## -4.384 -2.264  0.137  1.697  5.866 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 26.58491    1.42509   18.65  &lt; 2e-16 ***
## hp          -0.05889    0.00786   -7.50  2.9e-08 ***
## am           5.27709    1.07954    4.89  3.5e-05 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 2.91 on 29 degrees of freedom
## Multiple R-squared:  0.782,  Adjusted R-squared:  0.767 
## F-statistic:   52 on 2 and 29 DF,  p-value: 2.55e-10</code></pre>
<p>It appears that these are both influential predictors. We could examine the relationship graphically.</p>
</div>
<div id="visualizing-regression-data" class="section level2 hasAnchor" number="7.15">
<h2><span class="header-section-number">7.15</span> Visualizing regression data<a href="extra.html#visualizing-regression-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb465"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb465-1"><a href="extra.html#cb465-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mtcars, <span class="fu">aes</span>(<span class="at">x=</span>hp, <span class="at">y=</span>mpg, <span class="at">color=</span><span class="fu">factor</span>(am))) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb465-2"><a href="extra.html#cb465-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_smooth</span>(<span class="at">method=</span>lm, <span class="at">se=</span><span class="cn">FALSE</span>)</span></code></pre></div>
<p><img src="06_extra_files/figure-html/unnamed-chunk-24-1.png" width="672" /></p>
<p>There doesn’t appear to be any meaningful interaction between horsepower and transmission type.</p>
</div>
<div id="getting-results-into-a-tidy-useful-format" class="section level2 hasAnchor" number="7.16">
<h2><span class="header-section-number">7.16</span> Getting results into a tidy, useful format<a href="extra.html#getting-results-into-a-tidy-useful-format" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Note that the <code>broom</code> package is very useful for extracting global and specific statistics from many models in R, including regression models. The introductory vignette provides a number of useful examples: <a href="https://cran.r-project.org/web/packages/broom/vignettes/broom.html" class="uri">https://cran.r-project.org/web/packages/broom/vignettes/broom.html</a>. Here, what if we want to save the global statistics and parameter estimates into data.frame objects?</p>
<p>We can use the <code>glance</code> function to get the global model statistics.</p>
<div class="sourceCode" id="cb466"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb466-1"><a href="extra.html#cb466-1" aria-hidden="true" tabindex="-1"></a>broom<span class="sc">::</span><span class="fu">glance</span>(mpg_model)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 12
##   r.squared adj.r.squa…¹ sigma stati…²  p.value    df logLik   AIC   BIC devia…³
##       &lt;dbl&gt;        &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;
## 1     0.782        0.767  2.91    52.0 2.55e-10     2  -78.0  164.  170.    245.
## # … with 2 more variables: df.residual &lt;int&gt;, nobs &lt;int&gt;, and abbreviated
## #   variable names ¹​adj.r.squared, ²​statistic, ³​deviance</code></pre>
<p>And the <code>tidy</code> function yields the parameter table</p>
<div class="sourceCode" id="cb468"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb468-1"><a href="extra.html#cb468-1" aria-hidden="true" tabindex="-1"></a>broom<span class="sc">::</span><span class="fu">tidy</span>(mpg_model)</span></code></pre></div>
<pre><code>## # A tibble: 3 × 5
##   term        estimate std.error statistic  p.value
##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
## 1 (Intercept)  26.6      1.43        18.7  1.07e-17
## 2 hp           -0.0589   0.00786     -7.50 2.92e- 8
## 3 am            5.28     1.08         4.89 3.46e- 5</code></pre>
<p>As can imagine (and saw earlier in the functional programming overview), the ability to extract regression statistics into a tidy data.frame is a boon to scaling your analyses to multiple models and datasets.</p>
</div>
<div id="modeling-interactions" class="section level2 hasAnchor" number="7.17">
<h2><span class="header-section-number">7.17</span> Modeling interactions<a href="extra.html#modeling-interactions" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We can use the <code>*</code> operator in R to ask that both the constituent variables and their interaction(s) are entered into the model. For example:</p>
<div class="sourceCode" id="cb470"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb470-1"><a href="extra.html#cb470-1" aria-hidden="true" tabindex="-1"></a>int_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(mpg <span class="sc">~</span> hp<span class="sc">*</span>wt <span class="sc">+</span> am, mtcars)</span>
<span id="cb470-2"><a href="extra.html#cb470-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(int_model)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = mpg ~ hp * wt + am, data = mtcars)
## 
## Residuals:
##    Min     1Q Median     3Q    Max 
## -2.985 -1.658 -0.741  1.436  4.527 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 49.45224    5.28073    9.36  5.7e-10 ***
## hp          -0.11930    0.02655   -4.49  0.00012 ***
## wt          -8.10056    1.78933   -4.53  0.00011 ***
## am           0.12511    1.33343    0.09  0.92594    
## hp:wt        0.02749    0.00847    3.24  0.00313 ** 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 2.19 on 27 degrees of freedom
## Multiple R-squared:  0.885,  Adjusted R-squared:  0.868 
## F-statistic: 51.8 on 4 and 27 DF,  p-value: 2.76e-12</code></pre>
<p>This model includes individual effects of horsepower (<code>hp</code>) and weight (<code>wt</code>), as well as their interation (<code>hp:wt</code>). This highlights that the asterisk operator <code>*</code> will compute all possible interations among the specified predictors. For example, <code>a*b*c*d</code> will generate all effets up through and including the <code>a x b x c x d</code> interation. By contrast, if you wish to specify a given interaction manually/directly, use the colon operator (e.g., <code>a:b</code>). The downside of the colon operator is that it doesn’t guarantee that the corresponding lower-level effects are included, which is usually a sane default position. As a reminder, you should essentially never include an interation without including the lower level effects, because this can misassign the variance.</p>
<p>Note that with weight (<code>wt</code>) in the model, as well the horsepower x weight interaction, the automatic/manual transmission distinction is no longer significant (not even close). Let’s take a look at this interaction. For a two-way continuous x continuous interation, we typically separate one predictor into low (-1SD), medium (mean), and high (+1SD) levels, and plot separate lines for each.</p>
<div class="sourceCode" id="cb472"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb472-1"><a href="extra.html#cb472-1" aria-hidden="true" tabindex="-1"></a><span class="co">#handy 2-way interation plotting function from jtools.</span></span>
<span id="cb472-2"><a href="extra.html#cb472-2" aria-hidden="true" tabindex="-1"></a><span class="fu">interact_plot</span>(int_model, <span class="at">pred =</span> <span class="st">&quot;hp&quot;</span>, <span class="at">modx =</span> <span class="st">&quot;wt&quot;</span>)</span></code></pre></div>
<p>What do we see? At higher horsepower, gas mileage suffers regardless of the weight of the car. At lower horsepower, car weight makes a big difference (lower weight, higher mpg).</p>
</div>
<div id="contrasts-in-regression" class="section level2 hasAnchor" number="7.18">
<h2><span class="header-section-number">7.18</span> Contrasts in regression<a href="extra.html#contrasts-in-regression" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>(Some of the code and text here has been adapted from Russell Lenth’s excellent <code>emmeans</code> documentation: <a href="https://cran.r-project.org/web/packages/emmeans/" class="uri">https://cran.r-project.org/web/packages/emmeans/</a>)</p>
<p>One of the handiest packages in the R regression universe is <code>emmeans</code>, which can provide the ‘expected marginal means’ (em means), as well as a host of other contrasts and comparisons. In particular, it is very easy to test simple slopes and pairwise differences. Furthermore, the package works with <code>multcomp</code> to handle correction for multiple comparisons. See the longer documentation <a href="https://cran.r-project.org/web/packages/emmeans/vignettes/comparisons.html">here</a>.</p>
<p>Let’s look at the concentration of leucine in a study of pigs who were fed differing levels of protein in the diet (9, 12, 15, and 18%) and different protein sources (fish, soybean, milk). The concentration has a long positive tail, so here we log transform it to normalize things somewhat.</p>
<div class="sourceCode" id="cb473"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb473-1"><a href="extra.html#cb473-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(pigs, <span class="at">package=</span><span class="st">&quot;emmeans&quot;</span>)</span>
<span id="cb473-2"><a href="extra.html#cb473-2" aria-hidden="true" tabindex="-1"></a>pigs <span class="ot">&lt;-</span> pigs <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">log_conc=</span><span class="fu">log</span>(conc), <span class="at">percent_fac=</span><span class="fu">factor</span>(percent))</span>
<span id="cb473-3"><a href="extra.html#cb473-3" aria-hidden="true" tabindex="-1"></a>pigs.lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(log_conc <span class="sc">~</span> source <span class="sc">+</span> percent_fac, <span class="at">data =</span> pigs)</span>
<span id="cb473-4"><a href="extra.html#cb473-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(pigs.lm)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = log_conc ~ source + percent_fac, data = pigs)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -0.18858 -0.05980 -0.02158  0.08120  0.24601 
## 
## Coefficients:
##               Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)    3.22029    0.05361  60.067  &lt; 2e-16 ***
## sourcesoy      0.27277    0.05293   5.153 3.19e-05 ***
## sourceskim     0.40228    0.05416   7.428 1.50e-07 ***
## percent_fac12  0.17955    0.05608   3.202 0.003960 ** 
## percent_fac15  0.21740    0.05973   3.640 0.001370 ** 
## percent_fac18  0.29985    0.06762   4.434 0.000191 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.1151 on 23 degrees of freedom
## Multiple R-squared:  0.7566, Adjusted R-squared:  0.7037 
## F-statistic:  14.3 on 5 and 23 DF,  p-value: 2.054e-06</code></pre>
<p>This output is hard to look at because there are many dummy codes and we have to infer the reference condition for each factor (usually alphabetical). Also, we do not have an intuitive sense of the expected means in each condition because they depend on the sum of the intercept and the specific dummy code for the condition interest, averaging over the other factor.</p>
<p>We can obtain the expected means for each condition.</p>
</div>
<div id="expected-means-for-protein-source" class="section level2 hasAnchor" number="7.19">
<h2><span class="header-section-number">7.19</span> Expected means for protein source<a href="extra.html#expected-means-for-protein-source" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb475"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb475-1"><a href="extra.html#cb475-1" aria-hidden="true" tabindex="-1"></a>pigs.emm.s <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(pigs.lm, <span class="st">&quot;source&quot;</span>)</span>
<span id="cb475-2"><a href="extra.html#cb475-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(pigs.emm.s)</span></code></pre></div>
<pre><code>##  source emmean     SE df lower.CL upper.CL
##  fish     3.39 0.0367 23     3.32     3.47
##  soy      3.67 0.0374 23     3.59     3.74
##  skim     3.80 0.0394 23     3.72     3.88
## 
## Results are averaged over the levels of: percent_fac 
## Confidence level used: 0.95</code></pre>
</div>
<div id="expected-means-for-protein-level" class="section level2 hasAnchor" number="7.20">
<h2><span class="header-section-number">7.20</span> Expected means for protein level<a href="extra.html#expected-means-for-protein-level" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb477"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb477-1"><a href="extra.html#cb477-1" aria-hidden="true" tabindex="-1"></a>pigs.emm.p <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(pigs.lm, <span class="st">&quot;percent_fac&quot;</span>)</span>
<span id="cb477-2"><a href="extra.html#cb477-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(pigs.emm.p)</span></code></pre></div>
<pre><code>##  percent_fac emmean     SE df lower.CL upper.CL
##  9             3.45 0.0409 23     3.36     3.53
##  12            3.62 0.0384 23     3.55     3.70
##  15            3.66 0.0437 23     3.57     3.75
##  18            3.75 0.0530 23     3.64     3.85
## 
## Results are averaged over the levels of: source 
## Confidence level used: 0.95</code></pre>
</div>
<div id="means-in-each-cell-of-the-factorial-design" class="section level2 hasAnchor" number="7.21">
<h2><span class="header-section-number">7.21</span> Means in each cell of the factorial design<a href="extra.html#means-in-each-cell-of-the-factorial-design" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb479"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb479-1"><a href="extra.html#cb479-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">emmeans</span>(pigs.lm, <span class="sc">~</span>source<span class="sc">*</span>percent_fac))</span></code></pre></div>
<pre><code>##  source percent_fac emmean     SE df lower.CL upper.CL
##  fish   9             3.22 0.0536 23     3.11     3.33
##  soy    9             3.49 0.0498 23     3.39     3.60
##  skim   9             3.62 0.0501 23     3.52     3.73
##  fish   12            3.40 0.0493 23     3.30     3.50
##  soy    12            3.67 0.0489 23     3.57     3.77
##  skim   12            3.80 0.0494 23     3.70     3.90
##  fish   15            3.44 0.0548 23     3.32     3.55
##  soy    15            3.71 0.0507 23     3.61     3.82
##  skim   15            3.84 0.0549 23     3.73     3.95
##  fish   18            3.52 0.0547 23     3.41     3.63
##  soy    18            3.79 0.0640 23     3.66     3.93
##  skim   18            3.92 0.0646 23     3.79     4.06
## 
## Confidence level used: 0.95</code></pre>
</div>
<div id="pairwise-comparisons-among-protein-sources" class="section level2 hasAnchor" number="7.22">
<h2><span class="header-section-number">7.22</span> Pairwise comparisons among protein sources<a href="extra.html#pairwise-comparisons-among-protein-sources" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>If we wanted to compare the pairwise differences in the effect of protein source on leucine concentration while controlling for protein percentage (and potentially other variables we add to the model), we could use the <code>pairs</code> function:</p>
<div class="sourceCode" id="cb481"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb481-1"><a href="extra.html#cb481-1" aria-hidden="true" tabindex="-1"></a>pig_pairs <span class="ot">&lt;-</span> <span class="fu">pairs</span>(pigs.emm.s)</span>
<span id="cb481-2"><a href="extra.html#cb481-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(pig_pairs)</span></code></pre></div>
<pre><code>##  contrast    estimate     SE df t.ratio p.value
##  fish - soy    -0.273 0.0529 23  -5.153  0.0001
##  fish - skim   -0.402 0.0542 23  -7.428  &lt;.0001
##  soy - skim    -0.130 0.0530 23  -2.442  0.0570
## 
## Results are averaged over the levels of: percent_fac 
## P value adjustment: tukey method for comparing a family of 3 estimates</code></pre>
<p>Note that you can get a sense of the contrasts being tested by <code>emmeans</code> by examining the <code>@linfct</code> slot of the object. I’ve learned <em>a lot</em> by examining these contrast matrices and thinking about how to setup a (focal) contrast of interest. Also note that you get p-value adjustment for free (here, Tukey’s HSD method).</p>
<p>Contrasts for the predicted mean level of leucine contrast for each protein source, controlling for protein percentage.</p>
<div class="sourceCode" id="cb483"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb483-1"><a href="extra.html#cb483-1" aria-hidden="true" tabindex="-1"></a>pigs.emm.s<span class="sc">@</span>linfct</span></code></pre></div>
<pre><code>##      (Intercept) sourcesoy sourceskim percent_fac12 percent_fac15 percent_fac18
## [1,]           1         0          0          0.25          0.25          0.25
## [2,]           1         1          0          0.25          0.25          0.25
## [3,]           1         0          1          0.25          0.25          0.25</code></pre>
<p>What are the pairwise contrasts for the protein sources?</p>
<div class="sourceCode" id="cb485"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb485-1"><a href="extra.html#cb485-1" aria-hidden="true" tabindex="-1"></a>pig_pairs<span class="sc">@</span>linfct</span></code></pre></div>
<pre><code>##      (Intercept) sourcesoy sourceskim percent_fac12 percent_fac15 percent_fac18
## [1,]           0        -1          0             0             0             0
## [2,]           0         0         -1             0             0             0
## [3,]           0         1         -1             0             0             0</code></pre>
<p>The <code>emmeans</code> package also provides useful plots to understand pairwise differences:</p>
<div class="sourceCode" id="cb487"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb487-1"><a href="extra.html#cb487-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(pigs.emm.s, <span class="at">comparisons =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="06_extra_files/figure-html/unnamed-chunk-36-1.png" width="672" /></p>
<p>The blue bars are confidence intervals for the EMMs, and the red arrows are for the comparisons among them. If an arrow from one mean overlaps an arrow from another group, the difference is not significant, based on the adjust setting (which defaults to “tukey”). (Note: Don’t ever use confidence intervals for EMMs to perform comparisons; they can be very misleading.)</p>
</div>
<div id="pairwise-differences-and-simple-slopes-in-regression" class="section level2 hasAnchor" number="7.23">
<h2><span class="header-section-number">7.23</span> Pairwise differences and simple slopes in regression<a href="extra.html#pairwise-differences-and-simple-slopes-in-regression" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Returning to the iris dataset (from the parallel R examples), consider a model in which we examine the association between petal length and width across species. Here, we regress petal length on petal width, species (three levels), and their interaction.</p>
<div class="sourceCode" id="cb488"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb488-1"><a href="extra.html#cb488-1" aria-hidden="true" tabindex="-1"></a>fitiris <span class="ot">&lt;-</span> <span class="fu">lm</span>(Petal.Length <span class="sc">~</span> Petal.Width <span class="sc">*</span> Species, <span class="at">data =</span> iris)</span>
<span id="cb488-2"><a href="extra.html#cb488-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fitiris)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = Petal.Length ~ Petal.Width * Species, data = iris)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -0.84099 -0.19343 -0.03686  0.16314  1.17065 
## 
## Coefficients:
##                               Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)                     1.3276     0.1309  10.139  &lt; 2e-16 ***
## Petal.Width                     0.5465     0.4900   1.115   0.2666    
## Speciesversicolor               0.4537     0.3737   1.214   0.2267    
## Speciesvirginica                2.9131     0.4060   7.175 3.53e-11 ***
## Petal.Width:Speciesversicolor   1.3228     0.5552   2.382   0.0185 *  
## Petal.Width:Speciesvirginica    0.1008     0.5248   0.192   0.8480    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.3615 on 144 degrees of freedom
## Multiple R-squared:  0.9595, Adjusted R-squared:  0.9581 
## F-statistic: 681.9 on 5 and 144 DF,  p-value: &lt; 2.2e-16</code></pre>
<div class="sourceCode" id="cb490"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb490-1"><a href="extra.html#cb490-1" aria-hidden="true" tabindex="-1"></a>car<span class="sc">::</span><span class="fu">Anova</span>(fitiris, <span class="at">type=</span><span class="st">&quot;III&quot;</span>) <span class="co">#overall effects of predictors in the model</span></span></code></pre></div>
<pre><code>## Anova Table (Type III tests)
## 
## Response: Petal.Length
##                      Sum Sq  Df  F value    Pr(&gt;F)    
## (Intercept)         13.4329   1 102.8050 &lt; 2.2e-16 ***
## Petal.Width          0.1625   1   1.2438 0.2665889    
## Species              6.7474   2  25.8196 2.614e-10 ***
## Petal.Width:Species  2.0178   2   7.7213 0.0006525 ***
## Residuals           18.8156 144                       
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>Note that this yields a categorical (species) x continuous (petal width) interaction. The output from <code>car::Anova</code> indicates that the interaction is significant, but we need more detailed guidance on how the slope for petal width is moderated by species. We can visualize the interaction as follows:</p>
<div class="sourceCode" id="cb492"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb492-1"><a href="extra.html#cb492-1" aria-hidden="true" tabindex="-1"></a><span class="fu">interact_plot</span>(fitiris, <span class="at">pred =</span> <span class="st">&quot;Petal.Width&quot;</span>, <span class="at">modx =</span> <span class="st">&quot;Species&quot;</span>)</span></code></pre></div>
<p>In a simple slopes test, we might wish to know whether the slope for <code>Petal.Width</code> is non-zero in each species individually. Let’s start by getting the estimated marginal means for each species.</p>
<div class="sourceCode" id="cb493"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb493-1"><a href="extra.html#cb493-1" aria-hidden="true" tabindex="-1"></a><span class="fu">emmeans</span>(fitiris, <span class="sc">~</span>Species)</span></code></pre></div>
<pre><code>##  Species    emmean     SE  df lower.CL upper.CL
##  setosa       1.98 0.4699 144     1.05     2.91
##  versicolor   4.02 0.0609 144     3.90     4.14
##  virginica    5.02 0.1636 144     4.69     5.34
## 
## Confidence level used: 0.95</code></pre>
<p>And pairwise differences between species:</p>
<div class="sourceCode" id="cb495"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb495-1"><a href="extra.html#cb495-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(<span class="fu">emmeans</span>(fitiris, <span class="sc">~</span>Species))</span></code></pre></div>
<pre><code>##  contrast               estimate    SE  df t.ratio p.value
##  setosa - versicolor      -2.040 0.474 144  -4.306  0.0001
##  setosa - virginica       -3.034 0.498 144  -6.097  &lt;.0001
##  versicolor - virginica   -0.994 0.175 144  -5.692  &lt;.0001
## 
## P value adjustment: tukey method for comparing a family of 3 estimates</code></pre>
<p>Transitioning to petal width, because we are interested its linear effect (slope), we use the <code>emtrends</code> function to estimate the slope in each species individually. In terms of simple slopes, we test whether the Petal.Width slope is non-zero in each Species. The <code>infer</code> argument in the summary of <code>emtrends</code> requests t-tests and p-values for the slopes.</p>
<div class="sourceCode" id="cb497"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb497-1"><a href="extra.html#cb497-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">emtrends</span>(<span class="at">model =</span> fitiris, <span class="sc">~</span>Species, <span class="at">var=</span><span class="st">&quot;Petal.Width&quot;</span>), <span class="at">infer=</span><span class="cn">TRUE</span>)</span></code></pre></div>
<p>Finally, we could examine pairwise differences between slopes among species.</p>
<div class="sourceCode" id="cb498"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb498-1"><a href="extra.html#cb498-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(<span class="fu">emtrends</span>(<span class="at">model =</span> fitiris, <span class="sc">~</span>Species, <span class="at">var=</span><span class="st">&quot;Petal.Width&quot;</span>))</span></code></pre></div>
</div>
<div id="a-few-other-emmeans-features" class="section level2 hasAnchor" number="7.24">
<h2><span class="header-section-number">7.24</span> A few other emmeans features<a href="extra.html#a-few-other-emmeans-features" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In the pigs dataset, we have treated protein percentage as a fact (9, 12, 15, or 18 percent). If we keep this representation (as opposed to entering percentage as continuous), we can easily get orthogonal polynomial contrasts in <code>emmeans</code>. For example, is the effect of protein percent linearly related to leucine, or might it be quadratic or cubic?</p>
<div class="sourceCode" id="cb499"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb499-1"><a href="extra.html#cb499-1" aria-hidden="true" tabindex="-1"></a>pigs.emm.p <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(pigs.lm, <span class="st">&quot;percent_fac&quot;</span>)</span>
<span id="cb499-2"><a href="extra.html#cb499-2" aria-hidden="true" tabindex="-1"></a>ply <span class="ot">&lt;-</span> <span class="fu">contrast</span>(pigs.emm.p, <span class="st">&quot;poly&quot;</span>)</span>
<span id="cb499-3"><a href="extra.html#cb499-3" aria-hidden="true" tabindex="-1"></a>ply</span></code></pre></div>
<pre><code>##  contrast  estimate     SE df t.ratio p.value
##  linear      0.9374 0.2106 23   4.452  0.0002
##  quadratic  -0.0971 0.0883 23  -1.099  0.2830
##  cubic       0.1863 0.1877 23   0.992  0.3313
## 
## Results are averaged over the levels of: source</code></pre>
<div class="sourceCode" id="cb501"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb501-1"><a href="extra.html#cb501-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(ply) <span class="co">#show the contrast coefficients</span></span></code></pre></div>
<pre><code>##               percent_fac c.1 c.2 c.3
## percent_fac9            9  -3   1  -1
## percent_fac12          12  -1  -1   3
## percent_fac15          15   1  -1  -3
## percent_fac18          18   3   1   1</code></pre>
<p>There is a lot more on probing interations here: <a href="https://cran.r-project.org/web/packages/emmeans/vignettes/interactions.html" class="uri">https://cran.r-project.org/web/packages/emmeans/vignettes/interactions.html</a>.</p>
<p>Finally, we can examine effects in multivariate regression models (i.e., multiple DVs). Here, we can examine the sales of two varieties of oranges as a function of their prices, the day, and store. Sales for both oranges are modeled at once (<code>sales1</code> and <code>sales2</code>) to get a sense of price interdependence.</p>
<div class="sourceCode" id="cb503"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb503-1"><a href="extra.html#cb503-1" aria-hidden="true" tabindex="-1"></a>org.int <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">cbind</span>(sales1, sales2) <span class="sc">~</span> price1 <span class="sc">*</span> price2 <span class="sc">+</span> day <span class="sc">+</span> store, <span class="at">data =</span> oranges)</span>
<span id="cb503-2"><a href="extra.html#cb503-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(org.int)</span></code></pre></div>
<pre><code>## Response sales1 :
## 
## Call:
## lm(formula = sales1 ~ price1 * price2 + day + store, data = oranges)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -7.4646 -2.8230  0.4627  1.5425  6.8493 
## 
## Coefficients:
##               Estimate Std. Error t value Pr(&gt;|t|)   
## (Intercept)   67.91880   30.97512   2.193  0.03920 * 
## price1        -1.41364    0.60170  -2.349  0.02819 * 
## price2        -0.52938    0.68462  -0.773  0.44760   
## day2           0.19984    2.57232   0.078  0.93878   
## day3           7.57474    2.52069   3.005  0.00652 **
## day4           2.90480    2.52012   1.153  0.26143   
## day5           9.68284    2.56659   3.773  0.00105 **
## day6           5.51804    2.53842   2.174  0.04076 * 
## store2         1.58480    2.91591   0.544  0.59225   
## store3        -0.61385    3.01569  -0.204  0.84057   
## store4         2.54945    3.03622   0.840  0.41012   
## store5         1.83524    2.86046   0.642  0.52777   
## store6         7.01866    2.76358   2.540  0.01867 * 
## price1:price2  0.01369    0.01367   1.001  0.32755   
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 4.213 on 22 degrees of freedom
## Multiple R-squared:  0.761,  Adjusted R-squared:  0.6197 
## F-statistic: 5.387 on 13 and 22 DF,  p-value: 0.0002804
## 
## 
## Response sales2 :
## 
## Call:
## lm(formula = sales2 ~ price1 * price2 + day + store, data = oranges)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -8.5004 -1.8640 -0.1674  2.7834  9.9762 
## 
## Coefficients:
##                Estimate Std. Error t value Pr(&gt;|t|)   
## (Intercept)   -47.88395   38.70597  -1.237  0.22909   
## price1          1.69081    0.75187   2.249  0.03487 * 
## price2          0.89372    0.85549   1.045  0.30751   
## day2           -2.03219    3.21433  -0.632  0.53375   
## day3           10.10986    3.14981   3.210  0.00404 **
## day4            3.96694    3.14910   1.260  0.22097   
## day5            7.72972    3.20716   2.410  0.02475 * 
## day6            5.06292    3.17196   1.596  0.12472   
## store2          6.73894    3.64367   1.849  0.07787 . 
## store3          2.05515    3.76835   0.545  0.59099   
## store4          5.68186    3.79401   1.498  0.14845   
## store5          6.40091    3.57438   1.791  0.08710 . 
## store6          5.14117    3.45332   1.489  0.15075   
## price1:price2  -0.03199    0.01708  -1.872  0.07450 . 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 5.265 on 22 degrees of freedom
## Multiple R-squared:  0.7783, Adjusted R-squared:  0.6473 
## F-statistic:  5.94 on 13 and 22 DF,  p-value: 0.0001367</code></pre>
<p>Using <code>emmeans</code>, we can test the difference in sales of the two orange varieties as a function of the price of the first type (<code>price1</code>).</p>
<div class="sourceCode" id="cb505"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb505-1"><a href="extra.html#cb505-1" aria-hidden="true" tabindex="-1"></a><span class="co">#test the pairwise differences in price1 slopes between varieties.</span></span>
<span id="cb505-2"><a href="extra.html#cb505-2" aria-hidden="true" tabindex="-1"></a><span class="fu">emtrends</span>(org.int, pairwise <span class="sc">~</span> variety, <span class="at">var =</span> <span class="st">&quot;price1&quot;</span>, <span class="at">mult.name =</span> <span class="st">&quot;variety&quot;</span>)</span></code></pre></div>
<pre><code>## $emtrends
##  variety price1.trend    SE df lower.CL upper.CL
##  sales1        -0.749 0.171 22   -1.104   -0.394
##  sales2         0.138 0.214 22   -0.306    0.582
## 
## Results are averaged over the levels of: day, store 
## Confidence level used: 0.95 
## 
## $contrasts
##  contrast        estimate   SE df t.ratio p.value
##  sales1 - sales2   -0.887 0.24 22  -3.690  0.0013
## 
## Results are averaged over the levels of: day, store</code></pre>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="broom-and-dplyr.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="data-science-r-packages.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/USERNAME/REPO/edit/BRANCH/06_extra.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["learning_R.pdf"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
